# Первоначальная настройка компонентов ПО Carrot

## Настройка Carrot Server

### Общая информация

**Carrot Server** - единое место хранения медиа-контента и баз данных, представляет из себя связующее звяно между приложениями Carrot.

Интерфейс состоит из трёх полей:
- лента меню;
- поле компонентов;
- поле статуса.

Лента меню включает в себя 3 раздела:
- `File` - настройки приложения.
- `Tools` - инструменты приложения.
- `Help` - информация о текущей сборке.

---

### Settings

Для настройки **Carrot Server** необходимо выполнить следующее:

1. Запустите **Carrot Server**.

2. Откройте окно настроек по пути `File` - `Settings`.

3. Настройки **Carrot Server** имеют 3 раздела: `DataBase`, `Digital Assets`, `WebSocket`.

4. Раздел `DataBase`, включает следующие поля для редактирования:

- `Directory` - директория, в которой хранится база данных **Carrot Server**. *Примечание: данное поле лучше не редактировать.*
- `Replication Hosts` - IP-адреса резервных серверов на которые реплицируется база данных **Carrot Server**. Пример: 192.168.1.1 (единичный сервер), 192.168.1.1,192.168.1.2,192.168.1.3 (множество серверов записываются через запятую).
- `DB autoreplication on start` - автоматическая репликация базы данных **Carrot Server** при запуске приложения.

5. Раздел `Digital Assets`, включает следующие поля для редактирования:
- `Directory` - директория в которой хранятся медиа файлы, экспортируемые вместе с шаблонами, а также задаваемые через **Carrot Playlist**. *Примечание: данное поле лучше не редактировать.*

6. Раздел `WebSocket`, включает следующие поля для редактирования:
- `Certificate` - путь к файлу сертификата **.pfx**, если предполагается использование шифрованного соединения.
- `Certificate Password` - пароль к файлу сертификата **.pfx**.
- `Secure Connection` - установите `True`, если предполагается использование шифрованного соединения.

7. Нажмите кнопку `Save` и закройте окно настроек.

![Settings_Carrot Server_Settings](..\images\3189\image_001.jpg "Carrot Server - Settings")

---

### Tools

Инструменты приложения **Carrot Server** имеют следующие возможности:

- `Change Administrator Password` - смена пароля администратора.
- `Reset Events Status` - обновление поля компонентов для корректного отображения активных приложений.
- `Set Server As Master` - установить текущий сервер Host'ом (Host отображается в поле статуса как `Replication Index = 0`).
- `Replicate DB` - реплицировать базу данных **Carrot Server**.

### Важно!
- При использовании нескольких серверов с реплицируемой базой данных, каждому серверу автоматически присваивается `Replication Index`, где 0 - мастер, 1,2,3... - резерв. Если каждый сервер имеет значение равное 0, значит сервера не подцепились друг к другу.
- При отключении мастера, следующим мастером становится сервер, который быстрее остальных среагировал на процесс.
- Если известно, что подключение существует, но не отображается в списке подключений, то нажмите `Refresh` - программа войдет в цикл непрерывного обновления списка. Когда все подключения будут отображаться, нажмите `Refresh` еще раз.


---
---


## Настройка Carrot Launcher

### Общая информация

**Carrot Launcher** - модуль для запуска **Carrot Engine**. Используется для настройки и регистрации рабочих станций.

Лента меню включает в себя 3 раздела:
- `File` - настройки приложения.
- `Tools` - инструменты приложения.
- `Help` - информация о текущей сборке.

---

### Settings

1. Запустите **Carrot Server**.
2. Запустите **Carrot Launcher**.

>Если **Carrot Server** не был запущен, либо **Carrot Launcher** не смог установить с ним соединение, то на рабочем столе появится окно с ошибкой.
![Settings_Carrot Launcher_Settings](..\images\3189\image_002.png "Carrot Launcher - Settings")
>
>При нажатии на кнопку `Отмена` **Carrot Launcher** завершит работу.
>
>При нажатии на кнопку `Повтор` на рабочем столе откроется следующее окно `Settings` с настройками соединения **Carrot Launcher**.

![Settings_Carrot Launcher_Settings](..\images\3189\image_003.jpg "Carrot Launcher - Settings")

- Вкладка `Assets`
  - `Additional Assets` - путь к директории, в которой хранятся медиа файлы.
  - `Original Assets` - путь к директории, в которой хранятся медиа файлы. 
- Вкладка `Delays`
  - `Input Delay` - задержка видео на входе по умолчанию.
  - `Tracking Delay` - задержка данных с трекинг системы.
  - `AE Delay` - задержка АЕ шаблонов.
  - `Keyer Delay` - задержка трекинг данных от Keyer.
- Вкладка `Launch`
  - `Folder Path` - `Registry` - использование файлов из папки инициализированной через **Init Settings**.
  - `Folder Path` - `Local` - использование файлов из папки в которой был запущен **Carrot Launcher**.
- Вкладка `Network`
  - `Silent` - режим подключения без отображения сообщений об ошибках.
  - `Server Host` - имя или IP адрес хоста сервера.
  - `Secure` - режим защищенного подключения.
  - `Reserve Server Host` - имя или IP адрес резервного сервера.
- Вкладка `Processing`
  - `Watermark Filepath` - путь к файлу для водяного знака.
  - `Video threads count` - количество логических процессоров для обработки видеофайлов, `по умолчанию = 6`.
  - `Dedicated Processing` - обработка видео в выделенных логических процессорах.
  - `Foreground` - возвращает фокус на Carrot Engine каждые 10 секунд.
  - `Keyer` - тип Keyer'а: `JabKeyer` или `GreenKeyer`.
  - `Print Debug Info` - 
  - `Use GPU Memory` - использовать видеопамять для работы с PNG-секвенциями.
- Вкладка `Recording`
  - `Allow Recording` - включить / выключить возможность записывать изображение в Carrot Engine.
  - `Recording Directory` - путь к директории, где будут храниться записанные файлы.
  - `Recording FPS` - количество кадров в секунду при записи.
  - `Recording Bitrate` - битрейт записи, кбит/с.
  - `MaxBitrate` - максимальный битрейт записи, кбит/с.
- Вкладка `Videowall`
  - `Override` - разворачивает окно Carrot Engine не на полный экран, а на определенные координаты.
  - `X` - позиция X окна.
  - `Y` - позиция Y окна.
  - `Width` - ширина окна.
  - `Height` - высота окна.

3. После ввода всех необходимых настроек нажмите кнопку `Save` в верхнем правом углу окна и закройте окно `Settings`. **Carrot Launcher** произведет попытку подключения.

4. При успешном подключении к серверу на рабочем столе появится окно **Carrot Launcher**.

![Settings_Carrot Launcher](..\images\3189\image_004.jpg "Carrot Launcher")

Окно **Carror Launcher** имеет несколько вкладок со следующими опциями:

- Меню `File`
  - `Settings` (Горячая клавиша `F4`) - открывает окно настройки **Carrot Launcher** (вид и описание окна с его настройками изложены выше).
  - `Exit` (Комбинация клавиш `Alt + F4`) - выход из **Carrot Launcher**.
- Меню `Tools`
  - `Workstation Registration` - регистрация рабочей станции.
  > Вид и описание окна с его настройками изложены в разделе [Настройка и регистрация рабочей станции](https://carrotsoftware.github.io/docs/#/workflow?id=%d0%9d%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0-%d0%b8-%d1%80%d0%b5%d0%b3%d0%b8%d1%81%d1%82%d1%80%d0%b0%d1%86%d0%b8%d1%8f-%d1%80%d0%b0%d0%b1%d0%be%d1%87%d0%b5%d0%b9-%d1%81%d1%82%d0%b0%d0%bd%d1%86%d0%b8%d0%b8).
- Меню `Help`
  - `About` - информация о версии **ПО Carrot**.

---
---

## Настройка Carrot Web Playlist

### Settings

Для настройки **Carrot Playlist** необходимо выполнить следующее:

1.  Запустите **Carrot Server**.

2.  Запустите **Carrot Web Playlist Settings**. 

3. В параметре `Hosts` укажите порт для подключения. Например, *:8088 - где 8088 указывает на порт подключения.

4. В параметре `Certificate` укажите путь к сертификату.

5. В параметре `Certificate Password` укажите пароль к сертификату.

6. В параметре `Server Host` укажите IP адрес машины на которой запущен **Carrot Server**.

![Settings_Carrot WebPlaylist_Settings](..\images\3189\image_005.jpg "Carrot WebPlaylist - Settings")

7. Запустите `WebPlaylist.exe`, если запуск прошел успешно вы увидите следующее окно:

![Settings_Carrot WebPlaylist](..\images\3189\image_006.jpg "Carrot WebPlaylist")

8.  Запустите браузер (рекомендуется использовать **Google Chrome**) и в адресной строке введите `http://addr:port/` (где `addr` - IP адрес, либо имя машины, на которой запущен **Carrot Web Playlist**, `port` - порт). Например, `http://192.168.1.23:8088/`. При использовании сертификатов безопасности подключение нужно осуществлять через `https`.

![Settings_Carrot WebPlaylist_Browser](..\images\3189\image_007.jpg "Carrot WebPlaylist Browser")

9.  Введите `логин` и `пароль`.

---

### Browser

Окно **Carrot Web Playlist** имеет несколько вкладок со следующими опциями:

- Вкладка `Playlist` - служит для управления заполненными плейлистами.
- Вкладка `Editor` - создание и редактирование плейлистов.
- Вкладка `Browser` - отображает весь медиаконтент, загруженный на сервер (фото, видео, шаблоны UE4, шаблоны AE).

Во вкладке `Playlist` имеются следующие кнопки:

| Название     | Описание                                                                      |
| ------------ | ----------------------------------------------------------------------------- |
| `Load`       | загружает выбранное события в плейлисте.                                      |
| `Load all`   | загружает все события в плейлисте.                                            |
| `In`         | загружает и переводит активирует событие выбранное событие в плейлисте.       |
| `Next`       | деактивирует выделенное событие в плейлисте и активирует нижестоящее событие. |
| `Out`        | деактивирует выделенное событие в плейлисте.                                  |
| `Unload`     | выгружает выбранное события в плейлисте.                                      |
| `Unload all` | выгружает все события в плейлисте.                                            |

Каждое событие в Carrot Playlist может находиться в следующем состоянии:

| Название | Цвет                                        | Описание                                          |
| -------- | ------------------------------------------- | ------------------------------------------------- |
| Unloaded | <span style="color:gray">Серый</span>       | Событие с шаблоном не загружено внутри плейлиста. |
| Loading  | <span style="color:orange">Оранжевый</span> | Событие с шаблоном загружается внутри плейлиста.  |
| Ready    | <span style="color:blue">Голубой</span>     | Событие с шаблоном загружено и готово к работе.   |
| Active   | <span style="color:green">Зеленый</span>    | Событие с шаблоном активировано.                  |

> Процесс наполнения и редактирования событий в плейлисте описан в пункте [Создание плейлиста](workflow.md).

---
---

## Настройка Carrot System Monitor

### Общая информация

**Carrot System Monitor** - модуль для настройки и запуска **Carrot Engine**, а также для централизованного управления шаблонами и медиа контентом.

Лента меню включает в себя 2 раздела:
- `File` - настройки приложения.
- `Help` - информация о текущей сборке.

---

### Settings

Для настройки **Carrot System Monitor** необходимо выполнить следующее:

1. Запустите **Carrot Server**.
2. Запустите **Carrot System Monitor**.

>Если **Carrot Server** не был запущен, либо **Carrot System Monitor** не смог установить с ним соединение, то на рабочем столе появится окно с ошибкой.
![Settings_Carrot System Monitor_Settings](..\images\3189\image_002.png "Carrot System Monitor - Settings")
>
>При нажатии на кнопку `Отмена` **Carrot System Monitor** завершит работу.
>
>При нажатии на кнопку `Повтор` на рабочем столе откроется следующее окно `Settings` с настройками соединения **Carrot System Monitor**.

1. Вкладка `Network`.
   - `Server Host` - имя или IP адрес хоста сервера.
   - `Secure` - режим защищенного подключения.
   - `Reserve Server Host` - имя или IP адрес хоста сервера.
2. Вкладка `User`.
   - `Auto Logon` - автоматическая авторизация.
   - `User Name` - имя пользователя.
   - `Password` - пароль.

После ввода всех необходимых настроек нажмите кнопку `Save` в верхнем правом углу окна и закройте окно `Settings`. **Carrot System Monitor** произведет попытку подключения.

При успешном подключении к серверу на рабочем столе появится окно **Carrot System Monitor**:

![Settings_Carrot System Monitor](..\images\3189\image_008.jpg "Carrot System Monitor")

---

### Разделы Carrot System Monitor

| Раздел         | Описание                                                                                                                                                                                         |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Workstations` | Отображает список всех доступных на указанном сервере рабочих станций и список схем, в которых эти станции задействованы. Есть возможность удалять зарегистрированные рабочие станции с сервера. |
| `Engines`      | Отображает список всех доступных на указанном сервере схем и использованных в них рабочих станций. Есть возможность добавлять, редактировать и удалять схемы.                                    |
| `Users&Groups` | Отображает настройки прав группы пользователей. Есть возможность добавлять, редактировать и удалять их.                                                                                          |
| `Launcher`     | Отображает список всех созданных схем на указанном сервере. Есть возможность запускать, останавливать и производить сброс рабочих станций, указанных в выбранной пользователем схеме.            |

---

### Раздел `Workstations`

При нажатии на кнопку раздела `Workstations` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех зарегистрированных рабочих станций на указанном сервере и подключенные к ним схемы:

![Settings_Carrot System Monitor_Workstations](..\images\3189\image_009.jpg "Carrot System Monitor - Workstations")

Кнопка `Add Folder` добавляет директорию служит для более удобной организации работы с рабочими станциями.

### Раздел `Engines`

При нажатии на кнопку раздела `Engines` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех доступных схем на указанном сервере и указанные в них рабочие станции:

![Settings_Carrot System Monitor_Engines](..\images\3189\image_010.jpg "Carrot System Monitor - Engines")

- Кнопка `Add Folder` добавляет директорию служит для более удобной организации работы со схемами.
- Кнопка `Add Engine` позволяет пользователю создать в выбранной папке новую схему. Нажатие на неё открывает в новое окно и предлагает пользователю указать в поле название схемы. После необходимо подтвердить `OK`, либо отменить `Cancel` выбор.
- Кнопка `Edit Scheme` открывает новое окно `Engine Flowchart` для настройки схемы.

![Settings_Carrot System Monitor_Engine Flowchart](..\images\3189\image_011.jpg "Carrot System Monitor - Engine Flowchart")

Структура окна `Engine Flowchart`:

  - Название выбранной схемы.
  - `Registered inputs` - указанные у выбранной рабочей станции входы (ноды ввода).
  - `Registered outputs` - указанные у выбранной рабочей станции выходы (ноды вывода).
  - `Flowchart` - окно для настройки и сборки нод.
  - `Properties` - свойства выбранной ноды.
  - `Save` - сохранение изменений в схеме.

При выборе любой схемы в правой половине окна отображаются свойства выбранного плейлиста:

- `Name` - название схемы.
- `Add Workstation` - позволяет добавить в выбранную схему доступную рабочую станцию `Workstation`.

При нажатии на кнопку `Add Workstation` открывается новое окно для выбора рабочей станции `Workstation` из списка доступных на сервере. При выборе рабочей станции, пользователю предлагается подтвердить выбор с помощью кнопки `OK`.

![Settings_Carrot System Monitor_Workstation](..\images\3189\image_012.jpg "Carrot System Monitor - Workstation")

---

### Раздел `Users & Groups`

При нажатии на кнопку раздела `Users & Groups` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех доступных групп пользователей, пользователей в них на указанном сервере и указанные для них следующие редактируемые свойства:

- `Name` - имя группы или пользователя.
- `Role` - роль группы пользователей.
- `Login` - логин пользователя (редактируется).
- `Password` - пароль пользователя.

![Settings_Carrot System Monitor_Users & Groups](..\images\3189\image_013.jpg "Carrot System Monitor - Users & Groups")

При нажатии на кнопку `Add Group` открывается новое окно, в котором пользователю предлагается указать название создаваемой группы пользователей. Подтверждение ввода осуществляется при помощи кнопок `OK` (Подтвердить) и `Cancel` (Отмена).

При нажатии на кнопку `Add User` открывается новое окно, в котором пользователю предлагается указать имя нового пользователя. Подтверждение ввода осуществляется при помощи кнопок `OK` (Подтвердить) и `Cancel` (Отмена).

---

### Раздел `Launcher`

При нажатии на кнопку раздела `Launcher` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех доступных движков `Engines` на указанном сервере и указанные в них рабочие станции `Workstation` и позволяет управлять их работой:

![Settings_Carrot System Monitor_Launcher](..\images\3189\image_014.jpg "Carrot System Monitor - Launcher")

При выборе любой схемы, отображаемые справа связанные со схемой поля с рабочими станциями выделяются цветом, соответствующие их состоянию:

- <span style="color:gray">серый</span>/чёрный - рабочая станция недоступна для запуска.
- <span style="color:yellow; background:gray">желтый</span> - рабочая станция доступна для запуска.
- <span style="color:green">зелёный</span> - рабочая станция запущена.
- <span style="color:blue">синий</span> - рабочая станция выделена пользователем комбинацией клавиш <kbd>Ctrl + ЛКМ</kbd>.

Нажатие на кнопку `Start` запускает все доступные рабочие станции, либо только выделенную пользователем.

Нажатие на кнопку `Stop` останавливает все запущенные рабочие станции, либо только выделенную пользователем.

Нажатие на кнопку `Reset` сбрасывает внутри движка у всех или у определенной пользователем рабочей станции компоненты, имеющие буфер.

---
---

## Создание и экспорт самоподписанного сертификата Windows

Для создания самоподписанного сертификата для **Carrot Playlist** необходимо выполнить следующее:

1. Запустите **PowerShell** с правами **Администратора**.
1. Скопируйте имя компьютера (ПКМ по **Этот компьютер** → **Свойства** → **Имя устройства**).
1. Введите в консоль **PowerShell** (имя компьютера необходимо ввести без кавычек)  
   `$thumbprint=New-SelfSignedCertificate -DnsName "Имя компьютера" -CertStoreLocation cert:\LocalMachine\My |ForEach-Object{ $_.Thumbprint}`
1. Создайте папку для хранения сертификатов прим. `C:\Certificates`.
1. Создайте переменную пути сертификата консольной командой `$certpath = "Путь файла с кавычками прим. C:\Certificates\pc1.pfx"`.
1. Создайте переменную пароля консольной командой `$mypwd = ConvertTo-SecureString -String 123 -Force –AsPlainText` где `123` должен быть ваш пароль.
1. Введите в консоль **PowerShell**  
   `Export-PfxCertificate -FilePath $certpath -Cert cert:\localmachine\My\$thumbprint -Password $mypwd`.
1. Для импорта сертификата на текущем компьютере введите команду `Import-PfxCertificate -FilePath  $certpath -Password $mypwd -CertStoreLocation cert:\LocalMachine\Root`

---
---

## Импорт самоподписанного сертификата

Для импорта самоподписанного сертификата для **Carrot Playlist** необходимо выполнить следующее:

1. Запустите **PowerShell** с правами **Администратора**.
1. Создайте переменную пути сертификата консольной командой `$certpath = "Путь файла с кавычками прим. C:\Certificates\pc1.pfx"`.
1. Создайте переменную пароля консольной командой `$mypwd = ConvertTo-SecureString -String 123 -Force –AsPlainText` где `123` должен быть ваш пароль.
1. Импортируйте сертификат командой `Import-PfxCertificate -FilePath $certpath -Password $mypwd -CertStoreLocation cert:\LocalMachine\Root`

---
---