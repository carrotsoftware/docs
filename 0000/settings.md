# Первоначальная настройка компонентов ПО Carrot

>Данный блок описывает предназначение и функционал настроек разделов `Settings` и `Tools` в модулях **Carrot**.

## Шаг 1. Подключение лицензионного ключа Carrot.

Для работы с программным обеспечением **Carrot**, требуется использование лицензионного ключа соответствующего типа.

Лицензионный ключ хранится на флеш-накопителе. Для его использования достаточно вставить устройство в **USB** разъём.

Каждый модуль имеет свой подключаемый ключ, в случае, если на устройстве подразумевается использование нескольких и более модулей, необходимо использовать ключ с расширенным доступом (*например: `SERVER`, `TITLES`, `AR/VR`*).

Если ключ вставлен, то поле `Licence Key` в настройках модулей должно оставаться пустым.

![Settings_Licence](..\images\4062\image_069.jpg "Carrot Licence")

Для перехода в демо-режим, при отсутствии ключа, введите значение `0`.

![Settings_Licence](..\images\4062\image_070.jpg "Carrot Licence")

---
---

## Шаг 2. Настройка Carrot Server.

### Общая информация

**Carrot Server** - единое место хранения медиа-контента и баз данных, представляет из себя связующее звяно между приложениями Carrot.

Интерфейс состоит из трёх полей:
- лента меню;
- поле компонентов;
- поле статуса.

Лента меню включает в себя 3 раздела:
- `File` - настройки приложения.
- `Tools` - инструменты приложения.
- `Help` - информация о текущей сборке.

---

### Settings

Для настройки **Carrot Server** необходимо выполнить следующее:

1. Запустите **Carrot Server**.

2. Откройте окно настроек по пути `File` - `Settings`.

3. Настройки **Carrot Server** имеют 8 разделов: 

Раздел `Common`:

>`Server Name` - отображаемое имя сервера в **WebPlaylist System Monitor**.

![Settings_Carrot Server_Common](..\images\4062\image_071.jpg "Carrot Server - Settings - Common")

---

Раздел `Data Base`:

>`Directory` - директория, в которой хранится база данных **Carrot Server**. (*Примечание: данное поле лучше не редактировать*)
>
>`Unique Template names` - использовать уникальные имена шаблонов в базе данных.
>
>`Windows Restricted Chars` - проверить имена шаблонов на наличие символов с ограниченным доступом Windows `V:*'?<>|`.
>
>`Skylark Integration` - включить, если используется интеграция со **Skylark**.
>
>`Check Autorizations and Roles` - использовать проверку авторизации при входе в систему, проверка доступа к функциям по ролям.

![Settings_Carrot Server_Data Base](..\images\4062\image_072.jpg "Carrot Server - Settings - Data Base")

---

Раздел `Digital Assets`:

>`Directory` - директория в которой хранятся медиа файлы, экспортируемые вместе с шаблонами, а также задаваемые через **Carrot Playlist**. (*Примечание: данное поле лучше не редактировать*)
>
>`Copy Assets` - если `True`, ассеты будут скопированы в каталог сервера. Если `False`, он будет использовать только путь с ассетами.

![Settings_Carrot Server_Digital Assets](..\images\4062\image_073.jpg "Carrot Server - Settings - Digital Assets")

---

Раздел `GPIO`:
>`Keep UE Event Active Status` - при `True` нажатие на событие из плейлиста вызывает один и тот же стейт.

![Settings_Carrot Server_GPIO](..\images\4062\image_074.jpg "Carrot Server - Settings - GPIO")

---

Раздел `III Protocol Commands`:
>`Use STOP` - если используется интеграция по протоколу `III`, то мы можем игнорить команду `STOP`, воспринимая только команду `PLAY`. Это нужно для разного поведения проигрывания плейлиста извне.

![Settings_Carrot Server_III Protocol Commands](..\images\4062\image_075.jpg "Carrot Server - Settings - III Protocol Commands")

---

Раздел `Licence`:
>`Licence Key` - поле для внесения лицензионного ключа **Carrot**. Подробнее о поле можно узнать в `Шаг 1. Подключение лицензионного ключа Carrot`.

![Settings_Carrot Server_Licence](..\images\4062\image_076.jpg "Carrot Server - Settings - Licence")

---

Раздел `Replication`:
>`Replication Hosts` - IP-адреса резервных серверов на которые реплицируется база данных **Carrot Server**.
>- 192.168.1.1 (единичный сервер); 
>- 192.168.1.1`,`192.168.1.2`,`192.168.1.3 (множество серверов записываются через запятую).
>
>`DB autoreplication on start` - автоматическая репликация базы данных **Carrot Server** при запуске приложения.
>
>`Local IP for Replication` - локальный IP-адрес.

![Settings_Carrot Server_Replication](..\images\4062\image_077.jpg "Carrot Server - Settings - Replication")

---

Раздел `WebSocket`:
>`Certificate` - путь к файлу сертификата **.pfx**, если предполагается использование шифрованного соединения.
>
>`Certificate Password` - пароль к файлу сертификата **.pfx**.
>
>`Secure Connection` - установите `True`, если предполагается использование шифрованного соединения.

![Settings_Carrot Server_Replication](..\images\4062\image_078.jpg "Carrot Server - Settings - Replication")

---

4. Нажмите кнопку `Save` и закройте окно настроек.

![Settings_Carrot Server_Settings](..\images\4062\image_001.jpg "Carrot Server - Settings")

---

### Tools

Инструменты приложения **Carrot Server** имеют следующие возможности:

- `Change Administrator Password` - смена пароля администратора.

![Settings_Carrot Server_Common](..\images\4062\image_079.jpg "Carrot Server - Settings - Common")

- `Reset Events Status` - обновление поля компонентов для корректного отображения активных приложений.
- `Set Server As Master` - установить текущий сервер Host'ом (Host отображается в поле статуса как `Replication Index = 0`).
- `Replicate Database` - реплицировать базу данных **Carrot Server**.
- `Export DB file` - экспортировать базу данных.
- `Import DB file` - импортировать базу данных.
- `Update DB to current Version` - обновить базу данных до актуальной версии.

---

### **Работа с репликацией**

---

**1. Назначение**

Репликация (синхронизация) представляет из себя процесс копирования данных между вычислительными машинами (серверами). Таким образом, изменения, сделанные в одной копии, учитываются и в других копиях.

>***Важно!***
>
>Репликация данных часто используется в целях резервного копирования информации.

**2. Первоначальная настройка**

Как было изложено ранее, в процессе репликации (синхронизации) участвуют несколько вычислительных машин (серверов). 

>***Важно!***
>
>Стоит отметить, что настройка репликации часто зависит от условий конкретного проекта, количества используемой вычислительной техники и прочих факторов.

Рассмотрим пример с участием 2-х вычислительных машин (серверов) со следующими IP-адресами:

* `192.168.1.1` - будет являться резервным серверном;
* `192.168.1.2` - будет являться мастер-сервером (основным).

В настройках `Carrot Server` каждой вычислительной машины, необходимо найти раздел `Replication` со следующими параметрами:

* `Replication Hosts` - предназначен для указания IP-адреса(ов) резервного(ых) сервера(ов) с которым синхронизируется база данных Carrot Server.;
* `Local IP for Replication` - предназначен для указания локального IP-адреса вычислительной машины, с целью репликации (синхронизации) данных.

Внешний вид расположения раздела `Replication`:

![Replication_Carrot_server](..\images\Replication\Элемент%20Settings%20Раздел%20Replication.jpg)

В разделе `Replication` для вычислительной машины с IP-адресом `192.168.1.1` ввести:

* в параметр `Replication Hosts` - `192.168.1.2, 192.168.1.1`;

>***Важно!***
>
>В случае, если необходимо перечислить несколько IP-адресов в параметре `Replication Hosts` вводить их следует строго через запятую.
>
>Важно обратить внимание, что IP-адреса вычислительных машин (серверов) вводятся в порядке функционального предназначения каждой.

* в параметр `Local IP for Replication` - `192.168.1.1`.

>***Важно!***
>
>В случае, если введенён некорректный IP-адрес локальной вычислительной машины (сервера), например для вычислительной машины с локальным IP-адресом `192.168.1.1` будет указан `192.168.1.2`, то произойдёт ошибка в определении сервера как "Мастера" при нештатной ситуации, таким образом сервер не возьмёт на себя *резервную* роль.

В результате введённых данных для вычислительной машины (сервера) с IP-адресом `192.168.1.1` получим:

![ReplicationServer1](..\images\Replication\Replication_Server_1.jpg)

В разделе `Replication` для вычислительной машины с IP-адресом `192.168.1.2` ввести:

* в параметр `Replication Hosts` - `192.168.1.2, 192.168.1.1`;
* в параметр `Local IP for Replication` - `192.168.1.2`.

В результате введённых данных для вычислительной машины (сервера) с IP-адресом `192.168.1.2` получим:

![ReplicationServer2](..\images\Replication\Replication%20Server%202.png)

>***Важно!***
>
>В случае, если введены некорректные данные (не указан какой-либо из серверов, IP-адрес указан с ошибкой или т.п.) одной из вычислительной машины (сервера), то при пропытке запуска репликации (синхронизации) мастер-сервер "отключает" подключение и процесс прерывается.
>
>Если в проекте участвует более 2-х вычислительных машин (серверов), процесс настройки будет аналогичен, только с указанием нужного (большего) количества IP-адресов в параметре `Replication Hosts`.

В результате введённых настроек для каждой из вычислительных машин получим, что при внезапном прекращении работы мастер-сервера (`192.168.1.2`), происходит переключение на резервный сервер (`192.168.1.1`).

>***Важно!***
>
>Когда сервер является "мастером", у него появляется статус `Replication Master = True` в статус баре Carrot Server.
>
>Стоит учитывать, что при наличии большего количества резервных вычислительных машин, процесс перехода на "резерв" будет происходить до самой последней.


**3. Принцип работы в ПО Carrot**

Когда сервер находится в режиме репликации, он сравнивает в параметре `Replication Hosts` введённые данные об IP-адресах вычислительных машин (серверов) поочерёдно, так, например, если мастер-сервер с IP-адресом `192.168.1.2` обнаруживает аналогичный IP-адрес, то он считает себя "главным" (мастер-сервером) и в статус-баре появляется соответствующее сообщение `Replication Master = True`.

В случае, если IP-адрес не совпадает, то вычислительной машиной (сервером) будет происходить подключение к другим введённым IP-аресам. Таким образом, возможно несколько вариантов определения вычислительной машины (сервера):

* В случае, если настраиваемая вычислительная машина (сервер) успешно подключилась к серверу со статусом "мастер" (`Replication Master = True`), то она определяется как резервный со статусом `Replication Master = False`;
* В случае, если настраиваемая вычислительная машина (сервер) успешно подключилась к резервному серверу, то последняя передаёт информацию о сервере со статусом "мастер", в результате чего, настраиваемой вычилистельной машине (серверу) отсутствует необходимость в поиске конкретного IP-адреса среди введённых в параметр `Replication Hosts` и подключение осуществляется напрямую;
* В случае, если настраиваемой вычислительной машине (серверу) не удаётся подключиться к одному из серверов по IP-адресу, то происходит подключение к следующему IP-адресу, введённых в параметр `Replication Hosts`.

>***Важно!***
>
>Основным функционалом сервера со статусом ***"Мастер"*** является обработка поступающих команд от клиентов.
>
>Основным функционалом резервного сервера является синхронизация актуальной базы данных и ассетов сервера со статусом ***"Мастер"***.
>
>Во избежание некорректного запуска процесса репликации (синхронизации), рекомендуется запускать вычислительную машину (сервер) в том порядке, который указан в параметре `Replication Hosts`.

**4. Частые ситуации**

**4.1. Что делать, если у меня 2 Мастера?**

В случае, если обнаружена ситуация, при которой две вычислительной машины (сервера) определяются как "Мастер" (со статусом `Replication Master = True`), необходимо придерживаться следующих шагов:

* определить вычислительную машину (сервер), которая будет выполнять функцию "Мастера";
* в Carrot Server, нажать кнопку по следующему пути `Tools`/`Check Other Servers`.

![Button_Check_Other_Servers](..\images\Replication\Кнопка%20Check%20Other%20Servers.png)

После указанных действий, вычислительная машина (сервер) произведёт поиск других северов по указанным IP-адресам в параметре `Replication Hosts`. В случае установления успешного соединения, она примет статус "Резервная".

>***Важно!***
>
>Подобные ситуации, при которых две вычислительные машины (сервера) определяются как "Мастер", как правило, возникают при не соблюдении порядка их запуска (не в соответствии с порядком, указанным в параметре `Replication Hosts`).

**4.2. Как поменять "Мастера" и не выключать сервер?**

В случаях, когда необходимо изменить статус вычислительной машины (сервера) с "Резервного" на "Мастер", ему следует придерживаться следующих шагов:

* определить вычислительную машину (сервер) со статусом "Резервный", которая будет выполнять функцию "Мастера";
* в Carrot Server, нажать кнопку по следующему пути `Tools`/`Set Server As Master`.

![Button_Set_Server_As_Master](..\images\Replication\Кнопка%20Set%20Server%20As%20Master.png)

>***Важно!***
>
>Кнопка `Set Server As Master` имеет Hotkey `Ctrl+Shift+S`

В результате проделанных действий, резервная вычислительная машина (сервер) запросит у мастер-сервера соответствующие права, после получения которых, происходит переключение клиентов и других вычислительных машин (серверов) к нему.

>***Важно!***
>
>Изложенная операция возможна, только в тех случаях, когда резервный сервер произвёл репликацию (синхронизацию) с мастер-сервером. 
>
>При успешном завершении репликации (синхронизации) в статус-баре Carrot Server появится параметр `Replication Completed!`

**4.3. Что делать, если я неправильно запустил сервера и у меня удалилась актуальная база данных?**

В случае некорректного запуска вычислительных машин (серверов), важно помнить, что перед запуском процесса репликации (синхронизации), акутальная версия базы данных упаковывается в архив формата .zip по следующей директории (пути):

`C:\Users"ИМЯ_КОМПЬЮТЕРА"\AppData\Local\Carrot\backups\`

Распаковав архив в папку, в которой содержится база данных, пользователь актуализирует информацию, которая содержалась ранее перед запуском процесса репликации. 

---
---

### Важно!
- При использовании нескольких серверов с реплицируемой базой данных, каждому серверу автоматически присваивается `Replication Index`, где 0 - мастер, 1,2,3... - резерв. Если каждый сервер имеет значение равное 0, значит сервера не подцепились друг к другу.
- При отключении мастера, следующим мастером становится сервер, который быстрее остальных среагировал на процесс.
- Если известно, что подключение существует, но не отображается в списке подключений, то нажмите `Refresh` - программа войдет в цикл непрерывного обновления списка. Когда все подключения будут отображаться, нажмите `Refresh` еще раз.


---
---


## Шаг 3. Настройка Carrot Launcher.

### Общая информация

**Carrot Launcher** - модуль для запуска **Carrot Engine**. Используется для настройки и регистрации рабочих станций.

Лента меню включает в себя 3 раздела:
- `File` - настройки приложения.
- `Tools` - инструменты приложения.
- `Help` - информация о текущей сборке.

---

### Settings

1. Запустите **Carrot Server**.
2. Запустите **Carrot Launcher**.

>Если **Carrot Server** не был запущен, либо **Carrot Launcher** не смог установить с ним соединение, то на рабочем столе появится окно с ошибкой.
>
>![Settings_Carrot Launcher_Settings](..\images\3189\image_002.png "Carrot Launcher - Settings")
>
>При нажатии на кнопку `Отмена` **Carrot Launcher** завершит работу.
>
>При нажатии на кнопку `Повтор` на рабочем столе откроется следующее окно `Settings` с настройками соединения **Carrot Launcher**.

![Settings_Carrot Launcher_Settings](..\images\3998\image_003.jpg "Carrot Launcher - Settings")

---

Вкладка `Assets`
>`Additional Assets` - путь к директории, в которой хранятся медиа файлы.
>
>`Original Assets` - путь к директории, в которой хранятся медиа файлы. 

![Settings_Carrot Launcher_Settings](..\images\4062\image_080.jpg "Carrot Launcher - Settings")

---

Вкладка `Delays` (подробнее о задержках можно узнать в разделе `Работа с Carrot Engine`)

**Рабочие настройки задержки:**
>`Input Delay` - задержка видео на входе по умолчанию.
>
>`Secondary Delay` - задержка для изображения `Secondary Video` в `BmdTrackedInput`.
>
>`AE Delay` - задержка АЕ шаблонов.
>
>`Keyer Delay` - задержка трекинг данных от Keyer.

**Настройки задержки временно отключены при работе с Carrot:**
>`Audio Delay, ms`
>
>`XR Delay`
>
>`UE Draw Delay`
>
>`Max UE Draw Delay Buffer`
>
>`Lock UE Delay To Input Delay`

**Переключатель:**
>`Show all Delays` - если `True`, то в **Carrot Engine** будут отображены рабочие настройки задержки, указаные выше в разделе.

---

Вкладка `Events`

>`Unloading Event Type` - характер выгрузки событий из оперативной памяти.
>   - Если `Unloading Event Type` равен `Manual` - событие будет выгружаться только по команде из плейлиста.
>   - Если `Unloading Event Type` равен `Immediately` - событие будет выгружаться сразу после того как оно проигралось.
>
>`Unload Timer` - интервал времени, через который будет запущена проверка на наличие ассетов, которые можно выгрузить (*если `Unloading Event Type` равен `AfterTimer`*).
>
>`Unload After N Events` - количество позиций после текущего проигрываемого события, при достижении которого произойдёт выгрузка события. Например, при выставленном значении 3, событие в прейлисте на 7-й позиции будет выгружено, когда начнёт играться событие на 10-й позиции. (*если `Unloading Event Type` равен `EventsPlayedAfter`*).

---

Вкладка `Input`

>`GPIO Enabled` - включить GPIO.
>
>`MIDI Enabled` - включить MIDI.
>
>`Macro Enabled` - включить Macro (StreamDeck).

---

Вкладка `Launch`

>`Folder Path` - `Registry` - использование файлов из папки инициализированной через **Init Settings**.
>
>`Folder Path` - `Local` - использование файлов из папки в которой был запущен **Carrot Launcher**.

---

Вкладка `Licence`

>`Licence Key` - поле для внесения лицензионного ключа **Carrot**. Подробнее о поле можно узнать в `Шаг 1. Подключение лицензионного ключа Carrot`.

---

Вкладка `Network`
>`Silent` - режим подключения без отображения сообщений об ошибках.
>
>`Server Host` - имя или IP адрес хоста сервера.
>
>`Secure` - режим защищенного подключения.
>
>`Reserve Server Host` - имя или IP адрес резервного сервера.

---

Вкладка `Processing`
>`Watermark Filepath` - путь к файлу для водяного знака.
>
>`Video threads count` - количество логических процессоров для обработки видеофайлов, `по умолчанию = 6`.
>
>`Dedicated Processing` - обработка видео в выделенных логических процессорах.
>
>`Use Video Buffer` - если это поле включено (`True`) то в режиме `Dedicated Processing` будут использоваться заранее подготовленные буферы кадров, позволяющие проигрывать видео с нулевого кадра без задержек и проседания производительности.
>
>`Use Video GPU Decoder` - декодирование видео через видеокарту.
>
>`Foreground` - возвращает фокус на Carrot Engine каждые 10 секунд.
>
>`Keyer` - тип Keyer'а: `JabKeyer` или `GreenKeyer`. Подробнее о работе Keyer'ом можно узнать в разделе [Работа с Carrot Engine](engine.md).
>
>`Use GPU Memory` - использовать видеопамять для работы с PNG-секвенциями.
>
>`Enable Scripts Thread` - обработка скриптов и выражений АЕ в параллельном потоке (изначально они обрабатываются в рендер потоке, что сказывается на ЦП, но гарантирует выполнение скрипта в текущем кадре рендера).
>
>`Upload Contexts Count` - указывает количество входов и выходов.
>
>`Frames Ahead Play Count` - количество кадров, которое необходимо учитывать заранее, чтобы воспроизвести событие. Задержка на выходе суммируется отдельно.

---

Вкладка `Recording`
>`Allow Recording` - включить / выключить возможность записывать изображение в **Carrot Engine**, добавляет кнопку в разделе `Tools`.
>
>`Recording Directory` - путь к директории, где будут храниться записанные файлы.
>
>`Recording FPS` - количество кадров в секунду при записи.
>
>`Recording Bitrate` - битрейт записи, кбит/с.
>
>`MaxBitrate` - максимальный битрейт записи, кбит/с.

---

Вкладка `Render`
>`Initial Render Target Width` - инициализация ширины рендер таргета.
>
>`Initial Render Target Height` - инициализация высоты рендер таргета.

---

Вкладка `Tracking`
>`Use Tracking Interpolation` - аналог Use Delta MS, но здесь сохраняется выставление задержек в кадрах.
>
>`Restore Buffer Count` - автоматически сбрасывает буфер трекинга (Reset) когда трекинг статичен.
>
>*Если используется `Use Delta MS`, то настройка `Use Tracking Interpolation` и `Restore Buffer Count` не нужна*.

---

Вкладка `UI`
>`Show Connection Info` - показать в заголовке информацию о подключённом сервере.

---

Вкладка `Videowall`
>`Override` - разворачивает окно Carrot Engine не на полный экран, а на определенные координаты.
>
>`X` - позиция X окна.
>
>`Y` - позиция Y окна.
>
>`Width` - ширина окна.
>
>`Height` - высота окна.

---

3. После ввода всех необходимых настроек нажмите кнопку `Save` в верхнем правом углу окна и закройте окно `Settings`. **Carrot Launcher** произведет попытку подключения.

4. При успешном подключении к серверу на рабочем столе появится окно **Carrot Launcher**.

![Settings_Carrot Launcher](..\images\3189\image_004.jpg "Carrot Launcher")

Окно **Carror Launcher** имеет несколько вкладок со следующими опциями:

- Меню `File`
  - `Settings` (Горячая клавиша `F4`) - открывает окно настройки **Carrot Launcher** (вид и описание окна с его настройками изложены выше).
  - `Exit` (Комбинация клавиш `Alt + F4`) - выход из **Carrot Launcher**.
- Меню `Tools`
  - `Workstation Registration` - регистрация рабочей станции.

> Вид и описание окна с его настройками изложены в разделе [Настройка и регистрация рабочей станции](workflow.md).

- Меню `Help`
  - `About` - информация о версии **ПО Carrot**.

---
---

## Шаг 4. Настройка Carrot Web Playlist.

### Settings

Для настройки **Carrot Playlist** необходимо выполнить следующее:

1.  Запустите **Carrot Server**.

2.  Запустите **Carrot Web Playlist Settings**. 

>В графе `App Config`
>
>- `Hosts` укажите порт для подключения. Например, *:8088 - где 8088 указывает на порт подключения.
>
>- `Session Timeout` время бездействия пользователя, после которого происходит дисконнект (секунды).
>
>В графе `Assets`
>- `Enable Force Load` принудительное повторное скачивание ассетов шаблона и эвента с сервера, даже если ассеты уже были загружены локально при нажатии на кнопку в плейлисте. Подробнее в разделе [Дополнительные возможности Carrot](examples.md).
>
>- `Resend Assests` повторно отправляет ассеты с сервера веб-плейлиста на сервер Carrot DB (может иметь значение False только для локального хоста).
>
>В графе `Client Connection`
>
>- `Certificate` укажите путь к сертификату.
>
>- `Certificate Password` укажите пароль сертификата.
>
>- `Https` при использовании сертификатов безопасности выставить `True`.
>
>- `Wait servers list for web client` определяет список резервных веб-серверов, к которым веб-клиент может повторно подключиться.
>
>- `Wait For Client When Page Is Closed` число минут ожидания перед закрытием соединения.
>
>В графе `Licence`
>
>- `Licence Key` - поле для внесения лицензионного ключа **Carrot**. Подробнее о поле можно узнать в `Шаг 1. Подключение лицензионного ключа Carrot`.
>
>В графе `Network`
>
>- `Server Host` укажите IP адрес машины на которой запущен **Carrot Server**.
>
>- `Secure` `True`, если используете защищённое соединение.
>
>- `Reserve Server Host` укажите IP адрес резервного сервера.
>
>В графе `Playlist page`
>
>- `Only Current Story` применить действие кнопки управления только к текущей выбранной истории.
>
>В графе `Playlist Editor`
>
>- `Show State Viewer` включить окно `Preview` в разделе `Editor` в плейлисте.
>
>- `Always Show States` если `false`, скрыть стейты с двумя стейтами в шаблоне.
>
>- `Sync Event Name` если событие имеет только одну переменную текстового типа, это синхронизирует изменение значения переменной с изменением имени события.
>
>В графе `System Monitor page`
>
>- `Enable System Monitor page` - включить вкладку **System Monitor** в **WebPlaylist**'е.

![Settings_Carrot WebPlaylist_Settings](..\images\3998\image_005.jpg "Carrot WebPlaylist - Settings")

3. Запустите `WebPlaylist.exe`, если запуск прошел успешно вы увидите следующее окно:

![Settings_Carrot WebPlaylist](..\images\4062\image_006.jpg "Carrot WebPlaylist")

4.  Запустите браузер (рекомендуется использовать **Google Chrome**) и в адресной строке введите `http://addr:port/` (где `addr` - IP адрес, либо имя машины, на которой запущен **Carrot Web Playlist**, `port` - порт). Например, `http://192.168.1.23:8088/`. При использовании сертификатов безопасности подключение нужно осуществлять через `https`.

![Settings_Carrot WebPlaylist_Browser](..\images\3189\image_007.jpg "Carrot WebPlaylist Browser")

5.  Введите `логин` и `пароль`.

---

### Browser

Окно **Carrot Web Playlist** имеет несколько вкладок со следующими опциями:

- Вкладка `Playlist` - служит для управления заполненными плейлистами.
- Вкладка `Editor` - создание и редактирование плейлистов.
- Вкладка `Browser` - отображает весь медиаконтент, загруженный на сервер (фото, видео, шаблоны UE4, шаблоны AE).

Во вкладке `Playlist` имеются следующие кнопки:

| Название     | Описание                                                                      |
| ------------ | ----------------------------------------------------------------------------- |
| `Load`       | загружает выбранное события в плейлисте.                                      |
| `Load all`   | загружает все события в плейлисте.                                            |
| `In`         | загружает и переводит активирует событие выбранное событие в плейлисте.       |
| `Next`       | деактивирует выделенное событие в плейлисте и активирует нижестоящее событие. |
| `Out`        | деактивирует выделенное событие в плейлисте.                                  |
| `Unload`     | выгружает выбранное события в плейлисте.                                      |
| `Unload all` | выгружает все события в плейлисте.                                            |

Каждое событие в Carrot Playlist может находиться в следующем состоянии:

| Название | Цвет                                        | Описание                                          |
| -------- | ------------------------------------------- | ------------------------------------------------- |
| Unloaded | <span style="color:gray">Серый</span>       | Событие с шаблоном не загружено внутри плейлиста. |
| Loading  | <span style="color:orange">Оранжевый</span> | Событие с шаблоном загружается внутри плейлиста.  |
| Ready    | <span style="color:blue">Голубой</span>     | Событие с шаблоном загружено и готово к работе.   |
| Active   | <span style="color:green">Зеленый</span>    | Событие с шаблоном активировано.                  |

> Процесс наполнения и редактирования событий в плейлисте описан в пункте [Создание плейлиста](workflow.md).

---
---

## Шаг 5. Настройка Carrot System Monitor.

### Общая информация

**Carrot System Monitor** - модуль для настройки и запуска **Carrot Engine**, а также для централизованного управления шаблонами и медиа контентом.

Лента меню включает в себя 2 раздела:
- `File` - настройки приложения.
- `Help` - информация о текущей сборке.

---

### Settings

Для настройки **Carrot System Monitor** необходимо выполнить следующее:

1. Запустите **Carrot Server**.
2. Запустите **Carrot System Monitor**.

>Если **Carrot Server** не был запущен, либо **Carrot System Monitor** не смог установить с ним соединение, то на рабочем столе появится окно с ошибкой.
![Settings_Carrot System Monitor_Settings](..\images\3189\image_002.png "Carrot System Monitor - Settings")
>
>При нажатии на кнопку `Отмена` **Carrot System Monitor** завершит работу.
>
>При нажатии на кнопку `Повтор` на рабочем столе откроется следующее окно `Settings` с настройками соединения **Carrot System Monitor**.

1. Вкладка `Licence`.
   - `Licence Key` - поле для внесения лицензионного ключа **Carrot**. Подробнее о поле можно узнать в `Шаг 1. Подключение лицензионного ключа Carrot`.
2. Вкладка `Network`.
   - `Server Host` - имя или IP адрес хоста сервера.
   - `Secure` - режим защищенного подключения.
   - `Reserve Server Host` - имя или IP адрес хоста сервера.
3. Вкладка `UI`.
   - `Show Host` - показать в заголовке информацию о подключении к хосту.
4. Вкладка `User`.
   - `Auto Logon` - автоматическая авторизация.
   - `User Name` - имя пользователя.
   - `Password` - пароль.

![Settings_Carrot System Monitor_Settings](..\images\3998\image_053.jpg "Carrot System Monitor - Settings")

После ввода всех необходимых настроек нажмите кнопку `Save` в верхнем правом углу окна и закройте окно `Settings`. **Carrot System Monitor** произведет попытку подключения.

При успешном подключении к серверу на рабочем столе появится окно **Carrot System Monitor**:

![Settings_Carrot System Monitor](..\images\3189\image_008.jpg "Carrot System Monitor")

---

### Разделы Carrot System Monitor

| Раздел         | Описание                                                                                                                                                                                         |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Workstations` | Отображает список всех доступных на указанном сервере рабочих станций и список схем, в которых эти станции задействованы. Есть возможность удалять зарегистрированные рабочие станции с сервера. |
| `Engines`      | Отображает список всех доступных на указанном сервере схем и использованных в них рабочих станций. Есть возможность добавлять, редактировать и удалять схемы.                                    |
| `Users&Groups` | Отображает настройки прав группы пользователей. Есть возможность добавлять, редактировать и удалять их.                                                                                          |
| `Launcher`     | Отображает список всех созданных схем на указанном сервере. Есть возможность запускать, останавливать и производить сброс рабочих станций, указанных в выбранной пользователем схеме.            |
| `Keyer settings` | Отображает список сохранённых настроек кеера и адреса движков / серверов в которых они используются. |

---

### Раздел `Workstations`

При нажатии на кнопку раздела `Workstations` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех зарегистрированных рабочих станций на указанном сервере и подключенные к ним схемы:

![Settings_Carrot System Monitor_Workstations](..\images\3189\image_009.jpg "Carrot System Monitor - Workstations")

Кнопка `Add Folder` добавляет директорию служит для более удобной организации работы с рабочими станциями.

Кнопка `Clean Cache` удаляет с диска рендер машины только ассеты, которые относятся к эвентам в статусе `Unloaded`.

### Раздел `Engines`

При нажатии на кнопку раздела `Engines` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех доступных схем на указанном сервере и указанные в них рабочие станции:

![Settings_Carrot System Monitor_Engines](..\images\3189\image_010.jpg "Carrot System Monitor - Engines")

- Кнопка `Add Folder` добавляет директорию служит для более удобной организации работы со схемами.
- Кнопка `Add Engine` позволяет пользователю создать в выбранной папке новую схему. Нажатие на неё открывает в новое окно и предлагает пользователю указать в поле название схемы. После необходимо подтвердить `OK`, либо отменить `Cancel` выбор.
- Кнопка `Edit Scheme` открывает новое окно `Engine Flowchart` для настройки схемы.

![Settings_Carrot System Monitor_Engine Flowchart](..\images\3189\image_011.jpg "Carrot System Monitor - Engine Flowchart")

Структура окна `Engine Flowchart`:

  - Название выбранной схемы.
  - `Registered inputs` - указанные у выбранной рабочей станции входы (ноды ввода).
  - `Registered outputs` - указанные у выбранной рабочей станции выходы (ноды вывода).
  - `Flowchart` - окно для настройки и сборки нод.
  - `Properties` - свойства выбранной ноды.
  - `Save` - сохранение изменений в схеме.

При выборе любой схемы в правой половине окна отображаются свойства выбранного плейлиста:

- `Name` - название схемы.
- `Add Workstation` - позволяет добавить в выбранную схему доступную рабочую станцию `Workstation`.

При нажатии на кнопку `Add Workstation` открывается новое окно для выбора рабочей станции `Workstation` из списка доступных на сервере. При выборе рабочей станции, пользователю предлагается подтвердить выбор с помощью кнопки `OK`.

![Settings_Carrot System Monitor_Workstation](..\images\3189\image_012.jpg "Carrot System Monitor - Workstation")

---

### Раздел `Users & Groups`

При нажатии на кнопку раздела `Users & Groups` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех доступных групп пользователей, пользователей в них на указанном сервере и указанные для них следующие редактируемые свойства:

- `Name` - имя группы или пользователя.
- `Role` - роль группы пользователей.
- `Login` - логин пользователя (редактируется).
- `Password` - пароль пользователя.

![Settings_Carrot System Monitor_Users & Groups](..\images\3189\image_013.jpg "Carrot System Monitor - Users & Groups")

При нажатии на кнопку `Add Group` открывается новое окно, в котором пользователю предлагается указать название создаваемой группы пользователей. Подтверждение ввода осуществляется при помощи кнопок `OK` (Подтвердить) и `Cancel` (Отмена).

При нажатии на кнопку `Add User` открывается новое окно, в котором пользователю предлагается указать имя нового пользователя. Подтверждение ввода осуществляется при помощи кнопок `OK` (Подтвердить) и `Cancel` (Отмена).

---

### Раздел `Launcher`

При нажатии на кнопку раздела `Launcher` в **Carrot System Monitor** в окне появляется следующая структура, которая отображает список всех доступных движков `Engines` на указанном сервере и указанные в них рабочие станции `Workstation` и позволяет управлять их работой:

![Settings_Carrot System Monitor_Launcher](..\images\3189\image_014.jpg "Carrot System Monitor - Launcher")

При выборе любой схемы, отображаемые справа связанные со схемой поля с рабочими станциями выделяются цветом, соответствующие их состоянию:

- <span style="color:gray">серый</span>/чёрный - рабочая станция недоступна для запуска.
- <span style="color:yellow">желтый</span> - рабочая станция доступна для запуска.
- <span style="color:green">зелёный</span> - рабочая станция запущена.
- <span style="color:blue">синий</span> - рабочая станция выделена пользователем комбинацией клавиш <kbd>Ctrl + ЛКМ</kbd>.

Нажатие на кнопку `Start` запускает все доступные рабочие станции, либо только выделенную пользователем.

Нажатие на кнопку `Stop` останавливает все запущенные рабочие станции, либо только выделенную пользователем.

Нажатие на кнопку `Reset` сбрасывает внутри движка у всех или у определенной пользователем рабочей станции компоненты, имеющие буфер.

### Раздел `Keyer Settings`

Хранит ранее сохранённые пресеты кеера.
- Левый регион включает в себя сохранённые пресеты.
- Правый регион включает данные о выбранном пресете.

Кнопка `Delete settings` удаляет выбранный пресет. Для удаления нажмите на кнопку и подтвердите удаление.

![Settings_Carrot System Monitor_Keyer Settings](..\images\4062\image_115.jpg "Carrot System Monitor - Keyer Settings")

---
---

## Шаг 6. Работа с самоподписанным сертификатом Windows.

### Создание и экспорт самоподписанного сертификата Windows

Для создания самоподписанного сертификата для **Carrot Playlist** необходимо выполнить следующее:

1. Запустите **PowerShell** с правами **Администратора**.
1. Скопируйте имя компьютера (ПКМ по **Этот компьютер** → **Свойства** → **Имя устройства**).
1. Введите в консоль **PowerShell** (имя компьютера необходимо ввести без кавычек)  
   `$thumbprint=New-SelfSignedCertificate -DnsName "Имя компьютера" -CertStoreLocation cert:\LocalMachine\My |ForEach-Object{ $_.Thumbprint}`
1. Создайте папку для хранения сертификатов прим. `C:\Certificates`.
1. Создайте переменную пути сертификата консольной командой `$certpath = "Путь файла с кавычками прим. C:\Certificates\pc1.pfx"`.
1. Создайте переменную пароля консольной командой `$mypwd = ConvertTo-SecureString -String 123 -Force –AsPlainText` где `123` должен быть ваш пароль.
1. Введите в консоль **PowerShell**  
   `Export-PfxCertificate -FilePath $certpath -Cert cert:\localmachine\My\$thumbprint -Password $mypwd`.
1. Для импорта сертификата на текущем компьютере введите команду `Import-PfxCertificate -FilePath  $certpath -Password $mypwd -CertStoreLocation cert:\LocalMachine\Root`

---
---

### Импорт самоподписанного сертификата

Для импорта самоподписанного сертификата для **Carrot Playlist** необходимо выполнить следующее:

1. Запустите **PowerShell** с правами **Администратора**.
1. Создайте переменную пути сертификата консольной командой `$certpath = "Путь файла с кавычками прим. C:\Certificates\pc1.pfx"`.
1. Создайте переменную пароля консольной командой `$mypwd = ConvertTo-SecureString -String 123 -Force –AsPlainText` где `123` должен быть ваш пароль.
1. Импортируйте сертификат командой `Import-PfxCertificate -FilePath $certpath -Password $mypwd -CertStoreLocation cert:\LocalMachine\Root`

---
---
