# Список изменений rev. 4083 => rev. 4147

## Общие изменения
- в `Release` сборке отключены проекты, которые давно не используются (***Activation** и **RTC***);
- исправлена репликация ассетов при использовании **FTClient**;
- добавлено логирование старта движка;
- добавлено логирование ошибки отправки сообщения.

## Carrot Server
- исправлена репликация при работе с БД, когда серверы уже находятся в связке (*на репликантах не сохраняются состояния эвентов*).

## Carrot Launcher
- добавлен показ формы **Launcher**, если сервер работает в режиме `Local`, а сам **Launcher** на другой машине (*чтобы можно было изменить настройки*);
- исправлено сохранение настройки `UseGPUEncoder`;
- исправлено падение лаунчера при запущенных движках (*без аргументов запуска*);
оптимизирована работа `PvtDecklinkOutput` (*теперь задержка на стороне **с++** равна числу кадров преролла, а лок `CriticalSection` происходит в одном месте*);
- добавлен функционал использования буфера кадров для **CPU** видео в режиме `DedicatedProcessing`;
- исправлено сломанное проигрывание видео на разных слоях;
- возвращено проигрывание видео с разным стартом;
- `CUDAVideoTexture` откат до внесения изменений с показом 0 кадра (*в дальнейшем будет буферизация кадров*);
- добавлен декодинг видео на стороне `GPU` для `WebSocketInput` и `WebSocketOutput`.

## Carrot WebPlaylist
- добавлена блокировка нажатия клавиш при активном окне консоли веб-сервера (*раньше при нажатии клавиш в этом случае зависал веб-сервер, пока не нажмешь `Esc`*);
- исправлена прогрузка эвентов, вызывающих `Closing` стейт;
- добавлено обновление статуса на `Loading` в момент обновления эвента;
- изменено фоновое изображение в окне логина;
- исправлено поведение экспрешенов в **Preview Engine** (*моргающие слои*);
- добавлена обработка команды на скрытие шаблона по точному времени;
- добавлен функционал `Force Load` - принудительное скачивание ассетов шаблона, даже если ранее они уже были скачаны с **CarrotServer**;
- добавлена настройка в **WebPlaylistSettings**, позволяющая активировать данную функцию;
- изменён расчет прогнозированного старта шаблона (*для точного показа*);
- изменён расчет длительности показа шаблона (*учитывается, что `SetState` закрвающей анимации будет вызван только в следующем кадре*);
- изменён показ 0 кадра, а также добавлено определение состояния, когда у шаблона завершился закрывающий стейт.

## Carrot Engine
- добавлена проверка на тип лицензии в **CarrotEngine**;
- исправлено: `Keyer`: не освобождает ресурсы;
- исправлено: Вылет движка при попытке выгрузить шаблон;
- исправлено: Сбиваются настройки трекинга и параметры кеера;
- исправлено: Видео не передаётся с сервера на движок;
- добавлен лог в `GPIO`;
- добавлен `InvertOutput` для `GPIO`;
- в `GPIO` добавлены виды сигнала `Level` и `Pulse`;
- инвертировано использование `InvertOutput` (`GPIO`);
- исправлено логирование приходящего значения (`GPIO`);
- исправлен вылет движка, если запустить трекинг после старта движка;
- добавлено отображение количества `Received Data` и `Decoded Frames` в строке состояния;
- исправлено - `Keyer`: `gizmos` перекручиваются при пороговых значениях;
- исправлено - Если **Launcher** запустить после старта движка, то не будет возможности закрыть движок;
- исправлено - **Carrot Engine**: при старте схемы с `WebSocket Stream Input` возможен вылет;
- исправлено: падение при использовании `BmdTrackedInput` в режиме `i50`;
- если в схеме один `BmdInput`, то в строке состояния будет показано значение его буфера;
- убран функционал ожидания первого кадра - приводил к проседанию **FPS**.


## Работа с AE шаблонами
- исправлено использование трекинга в **TemplatePreview**;
- исправлено: **Template Preview**: пересохранение fbx-шаблона приводит к исчезновению fbx-файла на сервере;
- исправлено: **TemplatePreview**: видео при перетаскивании ползунка проигрывается дальше (*видимо, там просто вызывается `Update` вместо `SetPosition`*);
-  исправлено: Если два шаблона используют один видеофайл или одну секвенцию, либо один шаблон, либо со стейтом в режиме `Simultaneous`, то видео(секвенция) будет показываться акутальным только для последнего шаблона (стейта), а на предыдущем шаблоне (стейте) будет та же эта картинка, поскольку в данном случае используется один `TextureSource`;
- исправлено: **AE Template**: если два слоя используют одно видео с разным смещением, то по завершению стейта видео не остановится;
- исправлено: `time.CurrentTime` не возвращает корректно значение времени вложенной композиции (AE);
- добавлен функционал проигрывания видео и секвенций с 0 кадра;
- исправлено проигрывание видео в **Template Preview**;
- исправлено - **TemplatePreview**: при изменении `StartTime` у прекомпа съезжают анимации;
- исправлено - АЕ: маска на тексте остается на месте если слой привязан к родителю;
- добавлена проверка на наличие маски у текстового слоя при вызове `UpdateMasks()`;
- исправлено поведение `MatteTexture`;
- добавлена проверка на наличие эвентов для подготовки (*были ошибки при работе с **Template Preview***);
- добавлена возможность быстрого теста переменных в **Template Preview** (*без залезания в свойства слоев и смены значений*) через изменение `DefaultValue`;
- **TemplatePreview** -  добавлено отображение времени в кадрах;
- добавлено значение преролла для расчета времени опережения показа шаблона;
- добавлена настройка, позволяющая присваивать имя переменной в виде "Имя слоя (*имя переменной*)", либо как было (*просто имя переменной*).

## Работа с UE шаблонами
- UESendersResCtx скрыт из настроек и всегда равен `false`.

## Работа с DataStream
- исправлено удаление ячеек при удалении таблиц в **DataStream**;
- работа с `GlobalVars` со стороны **DataStream** (*можно добавлять/изменять/удалять*);
- удаление переменных из локального словаря клиента (***CarrotEngine**, **CarrotPreviewEngine**, **PaeLink**, **DataStream***) при удалении переменной через **DataStream**.